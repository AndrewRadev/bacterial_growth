{% from 'pages/upload/step3/_bioreplicate_form.html' import render_bioreplicate_form %}
{% from 'pages/upload/step3/_strain_form.html' import render_strain_form %}
{% from 'pages/upload/step3/_metabolite_form.html' import render_metabolite_form %}

{% macro render_step3_form(submission_form, upload_form) %}
  <form
      class="simple-form"
      action="{{ url_for('upload_step3_page') }}"
      method="POST">

    <div class="form-row">
      <label>
        <div>Type of vessel used</div>
        {{ upload_form.vessel_type(class='form-input-blue') }}
      </label>

      <div class="vessel-count vessel-bottles">
        <label>
          <div>Number of bottles</div>
          {{ upload_form.bottle_count(class='form-input-blue') }}
        </label>
      </div>

      <div class="vessel-count vessel-agar_plates hidden">
        <label>
          <div>Number of plates</div>
          {{ upload_form.plate_count(class='form-input-blue') }}
        </label>
      </div>

      <div class="vessel-count vessel-well_plates vessel-mini_react hidden">
        <label>
          <div>Number of columns</div>
          {{ upload_form.column_count(class='form-input-blue') }}
        </label>

        <label>
          <div>Number of rows</div>
          {{ upload_form.row_count(class='form-input-blue') }}
        </label>
      </div>

      <label>
        <div>Number of measurement time-points</div>
        {{ upload_form.timepoint_count(class='form-input-blue form-input-full') }}
      </label>
    </div>

    {% for technique in submission_form.fetch_techniques(): %}
      {{ render_technique_form(data=technique, prefix='technique-{}-'.format(loop.index0)) }}
    {% endfor %}

    <div class="form-row">
      <p>
        Add a type of measurement included in the study:
      </p>

      <div class="flex-right">
        <a href="#" class="white-button js-add js-add-bioreplicate">+ Bioreplicate</a>
        <a href="#" class="white-button js-add js-add-strains">+ Strains</a>
        <a href="#" class="white-button js-add js-add-metabolites">+ Metabolites</a>
      </div>
    </div>

    <template class="bioreplicate-form">
      {{ render_bioreplicate_form(data=None, prefix='') }}
    </template>

    <template class="strain-form">
      {{ render_strain_form(data=None, prefix='') }}
    </template>

    <template class="metabolite-form">
      {{ render_metabolite_form(submission_form, data=None, prefix='') }}
    </template>

    <div class="form-row">
      <input
          type="submit"
          class="form-input-full"
          value="Next" />
    </div>
  </form>

{% endmacro %}
