<div class="chart-container">
  {% if show_log_toggle: %}
    {% set identifier = 'apply_log:{}'.format(loop.index0) %}
    <div>
      <input
          type="checkbox"
          name="{{ identifier }}"
          id="{{ identifier }}"
          style="margin-left: 0"
          {{ 'checked' if request.args[identifier] }} />
      <label for="{{ identifier}}">
        Apply log transform
      </label>
    </div>
  {% endif %}

  {{ chart_html|safe }}

  <div class="contexts-list">
    {% for measurement_context in chart_form.measurement_contexts: %}
      {% set bioreplicate = measurement_context.bioreplicate %}
      {% set compartment  = measurement_context.compartment %}
      {% set technique    = measurement_context.technique %}
      {% set subject      = measurement_context.get_subject(g.db_session) %}

      <div class="flex-row context-row js-row" data-context-id="{{ measurement_context.id }}">
        <div class="left flex-row" data-tooltip="Move data trace to the left axis">
          <span class="icon icon-left"></span>
          <input
              type="checkbox"
              class="js-axis js-axis-left"
              name="axis|{{ measurement_context.id }}"
              {{ "checked" if measurement_context.id in chart_form.left_axis_ids }}
              value="left" />
        </div>

        <div class="middle {{ "align-right" if measurement_context.id in chart_form.right_axis_ids }}">
          {% if technique.subjectType == 'metabolite': %}
            <strong>{{ subject.name }}</strong>
          {% else: %}
            <strong>{{ technique.short_name }}</strong>
          {% endif %}

          {% if technique.units: %}
            (<strong>{{ technique.units }}</strong>)
          {% endif %}

          {% if technique.subjectType == 'bioreplicate' %}
            of the
            <strong>{{ subject.name }}<sub>{{ compartment.name }}</sub></strong>
            community
          {% elif technique.subjectType == 'metabolite': %}
            in
            <strong>{{ bioreplicate.name }}<sub>{{ compartment.name }}</sub></strong>
          {% else: %}
            of
            <strong>{{ subject.name }}</strong>
            in
            <strong>{{ bioreplicate.name }}<sub>{{ compartment.name }}</sub></strong>
          {% endif %}
        </div>

        <div class="flex-row right" data-tooltip="Move data trace to the right axis">
          <input
              type="checkbox"
              class="js-axis js-axis-right"
              name="axis|{{ measurement_context.id }}"
              {{ "checked" if measurement_context.id in chart_form.right_axis_ids }}
              value="right" />
          <span class="icon icon-right"></span>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
