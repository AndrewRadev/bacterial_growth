{% from 'utils/_dataframe.html' import render_dataframe %}
{% from 'utils/_strain_link.html' import render_strain_link %}

{% macro render_results_list(results, offset) %}
  {% for result in results: %}
    <li>
      <div class="search-result">
        <h3 class="flex-row flex-gap-10">
          <a href="{{ url_for('study_show_page', publicId=result.publicId) }}">
            [{{ result.publicId }}] {{ result.name }}
          </a>

          {% if not result.isPublished: %}
            <span
              class="icon icon-invisible"
              data-tooltip="This study is not published yet. You're seeing it because you uploaded it, you have permission to manage it, or you're an admin.">
            </span>
          {% endif %}
        </h3>

        {% if result.description: %}
          {{ result.description|format_text(first_paragraph=True) }}
        {% endif %}

        <p>
          <strong>Project ID</strong>:
          <a href="{{ url_for('project_show_page', publicId=result.project.publicId) }}">
            {{ result.project.publicId }}
          </a>
        </p>

        {% if result.studyURL and result.studyURL != '': %}
          <p>
            <strong>Publication URL</strong>:
            {{ result.studyURL|external_link() }}
          </p>
        {% endif %}

        <table class="simple-table margin-top-10">
          <tr>
            <th>Techniques</th>
            <th>Strains</th>
            <th>Metabolites</th>
          </tr>

          <tr>
            <td>
              <ul>
                {% for technique_name in result.studyTechniques|map(attribute="short_name_with_subject_type")|unique: %}
                  <li>{{ technique_name }}</li>
                {% endfor %}
              </ul>
            </td>

            <td>
              <ul>
                {% for strain in result.strains: %}
                  <li>{{ render_strain_link(strain) }}</li>
                {% endfor %}
              </ul>
            </td>

            <td>
              <ul>
                {% for metabolite in result.metabolites: %}
                  <li>
                    <a href="{{ url_for('metabolite_show_page', chebiId=metabolite.chebiId) }}">
                      {{ metabolite.name }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </td>
          </tr>
        </table>
      </div>
    </li>
  {% endfor %}
{% endmacro %}
