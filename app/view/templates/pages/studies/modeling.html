{% from 'utils/_post_button.html' import post_button %}
{% from 'pages/studies/modeling/_form.html' import render_modeling_form %}

{% extends '_layout.html' %}

{% block title %}: Models for study {{ study.publicId }}{% endblock %}

{% block content %}
  <div class="container study-page study-modeling-page" data-study-id="{{ study.publicId }}">
    {% include 'pages/studies/_header.html' %}

    <article>
      <h1>{{ study.name }}</h1>

      {% include 'pages/studies/_navigation_buttons.html' %}

      <div class="flex-row flex-gap-10">
        <p class="help">
          Select a type of model to fit on the study's measurements. The results
          will be available for visualization once the calculation is finished.
          {{ "data-analysis"|help_link("Read more") }}.
        </p>

        <div class="flex-row">
          {{ post_button(
            "Download model parameters",
            url_for('study_download_models_csv', publicId=study.publicId),
            class="flex-right flex-end"
          ) }}
        </div>
      </div>

      <form
          action="{{ url_for('study_modeling_submit_action', publicId=study.publicId) }}"
          class="simple-form modeling-form js-modeling-form">
        <div class="columns">
          <div class="controls-column">
            {{ render_modeling_form(study) }}
          </div>

          <div class="chart-column box">
            <div class="chart js-chart">
              <div class="chart-placeholder">
                ðŸ“Š
              </div>
            </div>
          </div>
        </div>
      </form>

      <div class="box margin-top-10 hidden js-custom-upload-form">
        <form
            enctype="multipart/form-data"
            action="{{ url_for('study_modeling_custom_create_action', publicId=study.publicId) }}"
            method="POST"
            class="simple-form">
          <h3>Upload custom model data</h3>

          <input type="hidden" name="selectedMeasurementContextId" />

          <div class="form-row">
            <label class="full">
              <span class="required">Model name</span>
              <input
                  required
                  name="name"
                  type="text"
                  class="form-input-blue form-input-full"
                  placeholder="Pick a short label for the model" />
            </label>

            <label
                class="full"
                data-tooltip="Where can people find more information about the modeling process?">
              <span>Information URL</span>
              <input
                  name="modelUrl"
                  type="url"
                  class="form-input-blue form-input-full"
                  placeholder="https://example.com" />
            </label>
          </div>

          <div class="form-row">
            <label class="full">
              <span>Description</span>
              <textarea
                  rows=2
                  name="description"
                  class="form-input-blue form-input-full"
                  placeholder="Provide a short description of your modeling methodology"></textarea>
            </label>
          </div>

          <hr>

          <div class="form-row">
            <label class="full">
              <span>Model predictions</span>
              <input
                  required
                  name="predictions"
                  type="file"
                  class="form-input-full" />
              <p class="help">
                Provide the predictions of your model that correspond to the
                selected measurements of <strong>TODO</strong>. The data should
                be a CSV with "time", "value", and (optionally) "std" columns.
              </p>
            </label>
          </div>

          <div class="form-row">
            <input type="submit" class="flex-right" value="Submit" />
          </div>
        </form>
      </div>
    </article>
  </div>

  {% assets "plotly_js" %}
  <script src="{{ ASSET_URL }}" type="text/javascript"></script>
  {% endassets %}
{% endblock %}
